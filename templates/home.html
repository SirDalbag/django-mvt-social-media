{% extends "components/base.html" %}
{% load django_app_filters_and_tags %}
{% load static %}
{% block main %}
<div class="flex">
    {% include "components/header.html" %}
    <main class="w-full min-h-screen border-x-2 md:border-x border-zinc-900">
        <div class="sticky top-0 z-20 bg-black bg-opacity-65 bg-blur backdrop-filter backdrop-blur-lg">
            <div class="grid grid-cols-2 w-full border-b-2 md:border-b border-zinc-900">
                <div class="flex justify-center p-4 transition duration-500 ease-in-out hover:bg-zinc-900">
                    <p class="font-semibold text-white text-base">For you</p>
                </div>
                <div class="flex justify-center p-4 transition duration-500 ease-in-out hover:bg-zinc-900">
                    <p class="font-semibold text-gray-400 text-base">Following</p>
                </div>
            </div>
        </div>
        <div class="flex flex-col gap-3 border-b-2 md:border-b border-zinc-900 p-4">
            <div class="flex gap-3">
                <img class="mt-3 w-8 h-8 2xl:w-10 2xl:h-10 rounded-full" src="{% static profile.avatar.url %}">
                <div class="flex flex-col gap-2 w-full">
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <textarea name="content" id="content"
                            class="rounded-lg block w-full border-0 py-3 bg-zinc-900 text-gray-400 font-semibold ring-inset focus:ring-2 focus:ring-inset focus:ring-sky-500 focus:text-gray-100 focus:bg-black"
                            placeholder="What is happening?" rows="2"></textarea>
                        <div id="container" class="flex flex-wrap w-full"></div>
                        <div class="flex items-center justify-between pt-3">
                            <!-- TODO It is required to implement a system of multiple adding of pictures -->
                            <label for="image" class="cursor-pointer">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="#0ea5e9" stroke-width="1" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" />
                                    <circle cx="8.5" cy="8.5" r="1.5" />
                                    <path d="M20.4 14.5L16 10 4 20" />
                                </svg>
                            </label>
                            <input name="image" id="image" class="hidden" type="file" onchange="displayImage(this)" />
                            <button id="post"
                                class="h-8 w-24 bg-sky-500 rounded-full text-white disabled:bg-sky-700 disabled:text-gray-300"
                                type="submit" disabled>
                                <p class="font-semibold text-sm">Post</p>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% if error %}
        <div
            class="text-center py-4 border-b-2 md:border-b border-zinc-900 transition duration-500 ease-in-out hover:bg-zinc-800 hover:bg-opacity-25">
            <p class="text-xl text-rose-600 font-semibold">{{ error }}</p>
        </div>
        {% endif %}
        <a href="">
            <div
                class="text-center py-4 border-b-2 md:border-b border-zinc-900 transition duration-500 ease-in-out hover:bg-zinc-800 hover:bg-opacity-25">
                <p class="font-normal text-sky-500 text-base">Show new posts</p>
            </div>
        </a>
        {% for post in posts %}
        <div
            class="flex flex-col gap-3 border-b-2 md:border-b border-zinc-900 p-4 transition duration-500 ease-in-out hover:bg-zinc-800 hover:bg-opacity-25">
            <div class="flex gap-3">
                <img class="w-8 h-8 2xl:w-10 2xl:h-10 rounded-full" src="{% static post.user.profile.avatar.url %}">
                <div class="flex flex-col gap-1 flex-grow">
                    <div class="flex flex-wrap gap-3 items-center">
                        <p class="font-semibold text-white text-lg">{{ post.user.profile.name }}</p>
                        <p class="font-normal text-gray-400 text-sm mt-1">@{{ post.user.username }}</p>
                        <p class="font-normal text-gray-400 text-sm mt-1">{{ post.creation_date }}</p>
                    </div>
                    <p class="font-normal text-white text-lg">{{ post.content }}</p>
                    {% if post.image %}
                    <img src="{% static post.image.url %}" class="rounded-lg border-2 border-zinc-900">
                    {% endif %}
                    <div class="flex gap-3 mt-2 justify-between">
                        <div class="flex gap-3">
                            <a href="">
                                <div class="flex gap-1 transition duration-500 ease-in-out group">
                                    <svg class="group-hover:stroke-sky-500" xmlns="http://www.w3.org/2000/svg"
                                        width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#52525b"
                                        stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    <p class="font-normal text-zinc-600 text-xs group-hover:text-sky-500">
                                        {{ post.comments_count }}</p>
                                </div>
                            </a>
                            {% with liked=post|has_like:request.user %}
                            <a href="{% url 'like' post.id %}">
                                <div class="flex gap-1 transition duration-500 ease-in-out group">
                                    <svg class="group-hover:stroke-sky-500 {% if liked %} fill-sky-500 {% endif %}"
                                        xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="#52525b" stroke-width="1" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                                        </path>
                                    </svg>
                                    <p
                                        class="font-normal {% if liked %} text-sky-500 {% else %} text-zinc-600 {% endif %} text-xs group-hover:text-sky-500">
                                        {{ post.likes_count }}</p>
                                </div>
                            </a>
                            {% endwith %}
                            <!-- TODO Implement a post view count system -->
                        </div>
                        <a href="">
                            <svg class="hover:stroke-sky-500" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="#52525b" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </main>
    {% include "components/footer.html" %}
</div>
{% endblock %}